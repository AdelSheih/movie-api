<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${movie.title} + ' - Details'">Movie Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(120deg, #232526 0%, #485563 100%);
            min-height: 100vh;
        }
        .main-poster {
            width: 100%;
            max-width: 350px;
            border-radius: 18px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.22);
            margin-bottom: 1.5rem;
        }
        .movie-details-card {
            background: rgba(30, 30, 40, 0.92);
            border-radius: 18px;
            box-shadow: 0 4px 24px rgba(0,0,0,0.18);
            color: #fff;
            padding: 2rem 2rem 1rem 2rem;
            margin-bottom: 2rem;
        }
        .carousel-inner, .carousel-item, .carousel-item img {
            border-radius: 18px;
        }
        .carousel-item img {
            max-height: 350px;
            object-fit: cover;
            width: 100%;
        }
        .btn-danger, .btn-primary, .btn-warning {
            border-radius: 20px;
        }
        .review-card {
            background: rgba(255,255,255,0.08);
            border-radius: 12px;
            color: #fff;
        }
        .review-body {
            font-size: 1.1rem;
        }
        .form-control, .form-select {
            border-radius: 16px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <a href="/" class="btn btn-link mb-3">&larr; Back to Movies</a>
    <div class="movie-details-card text-center">
        <img th:src="${movie.poster}" alt="Poster" class="main-poster mb-3">
        <h2 class="card-title mb-2" th:text="${movie.title}"></h2>
        <h6 class="card-subtitle mb-2 text-muted" th:text="${movie.releaseDate}"></h6>
        <p class="mb-1"><strong>Genres:</strong> <span th:text="${movie.genres}"></span></p>
        <p class="mb-1"><strong>IMDB ID:</strong> <span th:text="${movie.imdbId}"></span></p>
        <div class="mt-3">
            <strong>Average Rating:</strong>
            <span th:text="${#numbers.formatDecimal(movie.averageRating, 1, 1)}"></span>
            <span>/ 5</span>
            <span class="text-muted ms-2" th:text="'(' + ${movie.ratingCount} + ' ratings)'" th:if="${movie.ratingCount > 0}"></span>
        </div>
        <div class="mt-3">
            <a th:href="${movie.trailerLink}" class="btn btn-danger" target="_blank">Watch Trailer</a>
        </div>
    </div>
    <div th:if="${movie.backdrops != null && !movie.backdrops.isEmpty()}" class="mb-4">
        <div id="backdropCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div th:each="backdrop, iterStat : ${movie.backdrops}" th:classappend="${iterStat.index == 0} ? 'active' : ''" class="carousel-item">
                    <img th:src="${backdrop}" class="d-block w-100" alt="Backdrop">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#backdropCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#backdropCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
    <div class="mb-4">
        <h4>Reviews</h4>
        <div th:if="${#lists.isEmpty(reviews)}" class="text-muted">No reviews yet. Be the first to review!</div>
        <div th:each="review : ${reviews}" class="review-card p-3">
            <div class="review-body" th:text="${review.body}"></div>
        </div>
    </div>
    <div class="mb-5">
        <h4>Add a Review</h4>
        <form th:action="@{'/movies/' + ${movie.imdbId} + '/reviews'}" method="post">
            <div class="mb-3">
                <textarea class="form-control" name="body" rows="3" placeholder="Write your review..." required></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Submit Review</button>
        </form>
    </div>
    <div class="mb-4">
        <h4>Rate this Movie</h4>
        <form th:action="@{'/movies/' + ${movie.imdbId} + '/rate'}" method="post" class="mb-3">
            <div class="input-group" style="max-width: 200px;">
                <select class="form-select" name="rating" required>
                    <option value="" disabled selected>Rate...</option>
                    <option th:each="i : ${#numbers.sequence(1,5)}" th:value="${i}" th:text="${i}"></option>
                </select>
                <button class="btn btn-warning" type="submit">Rate</button>
            </div>
        </form>
    </div>
</div>
</body>
</html>